/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/pdfkit-commonmark@1.2.0/dist/commonmark-pdfkit-renderer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _utils=require("./utils"),_executeOperation=_interopRequireDefault(require("./logic/execute-operation")),Font=_interopRequireWildcard(require("./logic/font")),_defaultOptions=_interopRequireDefault(require("./default-options")),List=_interopRequireWildcard(require("./logic/list"));function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_getRequireWildcardCache=function(e){return e?n:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};var n=_getRequireWildcardCache(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&{}.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var PDFOperationPropertyStack=function(){return _createClass((function e(){_classCallCheck(this,e),this.stack=[]}),[{key:"push",value:function(e){return this.stack.push(e),this}},{key:"pop",value:function(){return this.stack.pop()}},{key:"peek",value:function(){if(0!==this.stack.length)return this.stack[this.stack.length-1]}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.stack.reduce((function(e,t){return Object.assign(e,t)}),{});return Object.assign(t,e)}},{key:"find",value:function(e){for(var t=this.stack.length-1;t>=0;t--){var n=this.stack[t];if(Object.prototype.hasOwnProperty.call(n,e))return n}}},{key:"getValue",value:function(e){var t=this.find(e);if(t)return t[e]}},{key:"getIncValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.find(e);if(n){if("number"!=typeof n[e])throw new Error("property '".concat(e,"' must be a number"));return n[e]+=t,n[e]}}}])}(),CommonmarkPDFKitRenderer=function(){return _createClass((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),"object"!==_typeof(t)||Array.isArray(t))throw new Error("options must be a plain object");this.options=(0,_utils.deepDefaults)(t,_defaultOptions.default)}),[{key:"operations",value:function(e){var t,n,r=e.walker(),i=[],o=new PDFOperationPropertyStack;o.push({font:"default",fontSize:this.options.fontSize||12,fillColor:this.options.fillColor||"black",strokeColor:"black",fillOpacity:1,strokeOpacity:1,continued:!1,listDepth:0});for(var a=function(e){for(var t=i.length-1;t>=0;t--){var n=i[t];if(Object.prototype.hasOwnProperty.call(n,e))return n}},l=function(e){var t="disc";switch(e){case"bullet":return"disc";case"ordered":return"arabic";default:return console.error("unkown list type '".concat(e,"', falling back to default: ").concat(t)),t}};t=r.next();){n=t.node;var u=i[i.length-1],s=function(){0===o.getValue("listDepth")&&i.push({moveDown:!0})};switch(n.type){case"text":t.entering&&i.push(o.get({text:n.literal}));break;case"softbreak":if(t.entering){var c=a("text");c&&!/ $/.test(c.text)&&i.push({text:" ",continued:!0})}break;case"linebreak":t.entering&&(u&&!0===u.continued&&(u.continued=!1),i.push(o.get({continued:!0,text:"\n"})));break;case"emph":if(t.entering){var f="bold"===o.getValue("font")?"bold-italic":"italic";i.push(o.push({font:f}).get())}else o.pop(),i.push(o.get());break;case"strong":if(t.entering){var p="italic"===o.getValue("font")?"bold-italic":"bold";i.push(o.push({font:p}).get())}else o.pop(),i.push(o.get());break;case"link":t.entering?i.push(o.push({fillColor:"blue",link:n.destination,underline:!0}).get()):(o.pop(),i.push(o.get()));break;case"image":case"document":case"html_inline":case"block_quote":case"html_block":break;case"code":t.entering?i.push(o.get({text:n.literal,font:Font.nameForCode(),fontSize:Font.sizeForCode(this.options)})):(o.pop(),i.push(o.get()));break;case"paragraph":t.entering?o.push({continued:!0}):(o.pop(),a("text").continued=!1,u.moveDown||s());break;case"item":if(t.entering){var h=o.getIncValue("listItemIndex");i.push(o.get({listItem:!0,listItemStyle:l(n._listData.type),listItemIndex:h}))}break;case"list":if(t.entering)i.push(o.push({listDepth:o.getValue("listDepth")+1,listItemIndex:-1}).get({listItemStyle:l(n._listData.type),list:!0}));else{for(var d=o.pop(),g=i.length-1;g>=0;g--){var y=i[g];if(y.listDepth===d.listDepth&&(!0!==y.listItem&&!0!==y.list||(y.listItemCount=d.listItemIndex+1),!0===y.list))break}i.push(o.get()),s()}break;case"heading":if(t.entering)i.push(o.push({font:Font.nameForHeadingLevel(n.level),fontSize:Font.sizeForHeadingLevel(n.level,this.options.fontSize),continued:!0}).get());else{o.pop(),i.push(o.get());var b=a("text");b&&(b.continued=!1),s()}break;case"code_block":t.entering&&(i.push(o.get({font:Font.nameForCode(),fontSize:Font.sizeForCode(this.options),text:n.literal})),s());break;case"thematic_break":t.entering&&(i.push({horizontalLine:!0}),s())}}return i.map((function(e,t,n){var r=n.slice(0,t).reduce((function(e,t){return Object.assign(e,t)}),{}),i={continued:function(e){return Object.prototype.hasOwnProperty.call(e,"text")},link:function(e){return Object.prototype.hasOwnProperty.call(e,"text")},underline:function(e){return Object.prototype.hasOwnProperty.call(e,"text")},font:function(e,t){var n=e.font!==t.font;return Object.prototype.hasOwnProperty.call(e,"text")&&n||n},fontSize:function(e,t){return t.fontSize!==e.fontSize},moveDown:function(){return!0},horizontalLine:function(){return!0},listItemStyle:function(e){return!0===e.listItem||!0===e.list},listItem:function(){return!0},listItemIndex:function(e){return!0===e.listItem},listItemCount:function(e){return e.listDepth>0||!0===e.listItem}},o=[];return r?Object.keys(e).filter((function(t){var n=Object.prototype.hasOwnProperty.call(i,t)&&i[t](e,r);return o.includes(t)||n||!Object.prototype.hasOwnProperty.call(i,t)&&e[t]!==r[t]})).reduce((function(t,n){return Object.assign(t,_defineProperty({},n,e[n]))}),{}):e}))}},{key:"heightOfMarkdown",value:function(e,t,n){return this.dimensionsOfMarkdown(e,t,n).h}},{key:"dimensionsOfMarkdown",value:function(e,t,n){var r=this,i=this.operations(t),o=n&&n.width||e.page&&e.page.width-e.page.margins.left-e.page.margins.right,a={x:e.x,y:e.y},l=Object.assign({},a,{w:o,h:0}),u=this.options.fontSize,s="",c=0;return i.forEach((function(t){var i=0;if(t.moveDown&&(i+=e._font.lineHeight(u,!0)*t.moveDown),t.moveUp&&(i-=e._font.lineHeight(u,!0)*t.moveUp),t.font){var o=Font.forInternalName(t.font,r.options);e.font(o)}if(t.fontSize&&(u=t.fontSize,e.fontSize(u)),t.text&&(s+=t.text,!t.continued)){var a=Object.assign({},n);n&&Object.prototype.hasOwnProperty.call(n,"width")&&(a.width=n.width-c),i+=e.heightOfString(s,a);var f=((s||"").match(/\n/g)||[]).length;f>0&&(i-=f*e._font.lineHeight(u,!0)),r.options.debug&&(console.log("\t",i,'from text "'.concat(s,'"')),console.log("\t","currentLineHeight",e._font.lineHeight(u,!0))),s=""}!0===t.list&&(c=t.listDepth*List.indent(e,t.listStyleType,t.listItemCount,n.fontSize)),r.options.debug&&(console.log("height change",i,"for",t),console.log("total height",l.h+i)),l.h+=i})),l}},{key:"render",value:function(e,t,n){var r=this,i=this.operations(t),o={y:e.y,x:e.x};i.forEach((function(t){(0,_executeOperation.default)(t,e,Object.assign({},r.options,{pdfkit:n}))}));var a=e.y;e.x;return{y:o.y,x:o.x,w:n&&n.width||e&&e.page&&e.page.width-e.page.margins.left-e.page.margins.right||0,h:a-o.y}}}])}(),_default=exports.default=CommonmarkPDFKitRenderer;
//# sourceMappingURL=/sm/1d72255833c69e0b72ad85c5343489cd39074225979270ed186ce71a6c7e3e90.map